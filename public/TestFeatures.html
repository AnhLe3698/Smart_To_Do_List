<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!--title-->
  <title>Smart To-Do-List</title>

  <!--css links-->
  <link rel="stylesheet" href="./resources/dependencies/bootstrap.min.css" type="text/css">
  <link rel="stylesheet" href="./styles/css/nav.css" type="text/css">
  <link rel="stylesheet" href="./styles/css/main.css" type="text/css">
  <link rel="stylesheet" href="./styles/css/footer.css" type="text/css">

  <!-- resources -->
  <script src="./resources/dependencies/jquery_3.6.1.min.js"></script>
  <script src="./scripts/listDrag.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@900&display=swap" rel="stylesheet">

</head>

<body>

  <nav class=" navbar navbar-dark bg-primary">
    <span class="navbar-brand">Smart TO DO List</span>
  </nav>

  <main>
    <h3>Login</h3>

    <form id="logging-in" action="/login" method="POST">
      <div class="form-group">
        <label for="email">Email address</label>
        <input class="form-control" type="email" name="email" placeholder="Enter email" style="width: 300px">
      </div>
      <!-- <div class="form-group">
          <label for="password">Password</label>
          <input class="form-control" type="password" name="password" placeholder="Password" style="width: 300px">
        </div> -->
      <button type="submit" class="btn btn-primary">Login</button>
    </form>

    <section id="item-container">
      <section class="toBuy toDoBox box">
        <header class="toDoHeader">To Buy Section</header>
        <section>
          <ul id = "items-to-buy" class="list-group">
          </ul>
        </section>
      </section>`
    </section>

    <script>
      $(() => {

        $.get('/users', (data) => {
          const errorString = 'Not logged in';
          const $data = data;
          if ($data === errorString) {
            $('main').append($data);
          } else {
            data.map(item=>{
                const $item = listItems(item);
                $('#items-to-buy').append($item)
              });
          }
        });
      })
      const listItems = function (items) {
        let markup = `
          <li class="dropzone list-group" id=${items.id} draggable="true">${items.name}</li>
           `;
        return markup;
      }

      $('#logging-in').submit((event) => {
        event.preventDefault();
        const formData = new FormData(document.querySelector('#logging-in'))
        const errorString = 'Invalid email';
        $.post('/users/login', { email: formData.get('email') }).done(function (data) {
          const $data = data;
          if ($data === errorString) {
            $('main').append($data);
          } else {
            data.map(item=>{
                const $item = listItems(item);
                $('#items-to-buy').append($item)
              });
          }
        });
      });
    </script>

      <button id="logout-button" class="btn btn-primary">Logout</button>
      <script>
        $('#logout-button').on('click', (event) => {
          event.preventDefault();
          $.get('/users/logout').done(function(data) {
            const $data = data;
          });
        });
      </script>

      <h3>Register</h3>
      <form id="register-user" action="/register" method="POST">
        <div class="form-group">
          <label for="email">Email address</label>
          <input class="form-control" type="email" name="email" placeholder="Enter email" style="width: 300px">
          <label for="first-name">First Name</label>
          <input class="form-control" type="name" name="first-name" placeholder="Enter first Name" style="width: 300px">
          <label for="first-name">Last Name</label>
          <input class="form-control" type="name" name="last-name" placeholder="Enter Last Name" style="width: 300px">
        </div>
        <!-- <div class="form-group">
    <h3>Register</h3>
    <form id="register-user" action="/register" method="POST">
      <div class="form-group">
        <label for="email">Email address</label>
        <input class="form-control" type="email" name="email" placeholder="Enter email" style="width: 300px">
        <label for="first-name">First Name</label>
        <input class="form-control" type="name" name="first-name" placeholder="Enter first Name" style="width: 300px">
        <label for="first-name">Last Name</label>
        <input class="form-control" type="name" name="last-name" placeholder="Enter Last Name" style="width: 300px">
      </div>
      <div class="form-group">
          <label for="email">Password</label>
          <input class="form-control" type="password" name="password" placeholder="Password" style="width: 300px">
        </div> -->
      <button type="submit" class="btn btn-primary">Register</button>
    </form>

    <script>
      $('#register-user').submit((event) => {
        event.preventDefault();
        const formData = new FormData(document.querySelector('#register-user'))
        const errorString = 'Invalid email';
        let email = formData.get('email');
        let firstName = formData.get('first-name');
        let lastName = formData.get('last-name');
        console.log(email, firstName, lastName);
        if (email.length !== 0 && firstName.length !== 0 && lastName.length !== 0) {
          $.post('/users/register', { 'email': email, 'firstName': firstName, 'lastName': lastName }).done(function (data) {
            const $data = data;
            if ($data === errorString) {
              $('main').append($data);
            } else {
              $('main').append($data);
              // $('main').append('Login Successful');
            }
          });
        }

      });
    </script>


    <h3>Add item</h3>
    <form id="add-item">
      <div class="form-group">
        <label for="name">Enter item name</label>
        <input class="form-control" type="text" name="name" placeholder="Add name" style="width: 300px">
        <label for="category">Enter item category</label>
        <input class="form-control" type="text" name="category" placeholder="Add category" style="width: 300px">
      </div>
      <button type="submit" class="btn btn-primary">Add</button>
    </form>


    <script>
      $('#add-item').submit((event) => {
        event.preventDefault();
        const formData = new FormData(document.querySelector('#add-item'))
        const errorString = 'Invalid item';
        let name = formData.get('name');
        let category = formData.get('category');

        if (name.length !== 0 && category.length !== 0) {
          $.post('/users/insert', { 'name': name, 'category': category }).done(function (data) {
            const $data = data;
            if ($data === errorString) {
              $('main').append($data);
            } else {
              $('main').append($data);
            }
          });
        }

      });
    </script>


    <h3>Remove item</h3>
    <form id="remove-item">
      <div class="form-group">
        <label for="itemName">Enter item name</label>
        <input class="form-control" type="text" name="itemName" placeholder="Add item Name" style="width: 300px">
      </div>
      <button type="submit" class="btn btn-primary">remove</button>
    </form>


    <script>
      $('#remove-item').submit((event) => {
        event.preventDefault();
        const formData = new FormData(document.querySelector('#remove-item'))
        const errorString = 'Invalid item';
        let itemName = formData.get('itemName');
        console.log('clicked and detected');
        if (itemName.length !== 0) {
          $.post(`/users/delete/${itemName}`).done(function (data) {
            const $data = data;
            console.log('callback detected');
            if ($data === errorString) {
              $('main').append($data);
            } else {
              $('main').append($data);
            }
          });
        }

      });
    </script>

    <!-- <h3>Enter user email to display items</h3>
    <form id="display-items">
      <div class="form-group">
        <label for="email">Enter user email </label>
        <input class="form-control" type="text" name="email" placeholder="Add email" style="width: 300px">
      </div>
      <button type="submit" class="btn btn-primary">remove</button>
    </form> -->


    <script>


      // $('#display-items').submit((event) => {
      //   event.preventDefault();
      //   const formData = new FormData(document.querySelector('#display-items'));
      //   let email = formData.get('email');
      //   const errorString = 'Invalid item';

      //   if (email.length !== 0) {
      //     $.post(`/users`, { 'email': email }).done(function (data) {
      //       const $data = data;
      //       if ($data === errorString) {
      //         $('main').append($data);
      //       } else {
      //         data.map(item=>{
      //           const $item = listItems(item);
      //           $('#items-to-buy').append($item)
      //         })
      //       }
      //     });
      //   }

      // })
    </script>

    <div>sdsadassa</div>
    <div>sdsadassa</div>
    <div>sdsadassa</div>
    <div>sdsadassa</div>
    <!-- <section id="item-container">
      <section class="toBuy toDoBox box">
        <header class="toDoHeader">To Buy Section</header>
        <section>
          <ul id = "items-to-buy" class="list-group">
          </ul>
        </section>
      </section>`
    </section> -->

  </main>

  <footer>
    Kevin Le, Mohamed Khalaf, Carolyn Wang
  </footer>
</body>
<script type="text/javascript" src="./scripts/client.js"></script>

</html>
